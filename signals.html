<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدليل التفاعلي لـ Angular Signals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --brand-red: #DD0031;
            --brand-blue: #0ea5e9;
            --brand-green: #22c55e;
            --brand-purple: #8b5cf6;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-code: #020617;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-code: #e2e8f0;
            --border-color: #e2e8f0;
            --shadow-color: rgba(149, 157, 165, 0.1);
        }
        
        .dark {
             --bg-primary: #0f172a;
             --bg-secondary: #1e293b;
             --bg-code: #020617;
             --text-primary: #f8fafc;
             --text-secondary: #94a3b8;
             --border-color: #334155;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- Sidebar --- */
        #sidebar {
            background-color: var(--bg-primary);
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-link {
            transition: all 0.2s ease;
            border-right: 2px solid transparent;
        }
        .sidebar-link:hover {
            background-color: var(--bg-secondary);
            color: var(--brand-blue);
            border-right-color: var(--brand-blue);
        }
        .sidebar-link.active {
            background-color: var(--bg-secondary);
            color: var(--brand-red);
            font-weight: 600;
            border-right-color: var(--brand-red);
        }
        #sidebar-toggle {
             background: var(--bg-primary);
             color: var(--text-secondary);
        }
        @media (max-width: 768px) {
            #sidebar {
                transform: translateX(100%);
            }
            #sidebar.open {
                transform: translateX(0);
            }
        }

        /* --- Main Content --- */
        main.prose {
            max-width: 80ch;
        }
        .prose h1, .prose h2, .prose h3, .prose h4 {
            color: var(--text-primary);
            font-weight: 700;
        }
        .prose h2 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        .prose p, .prose ul, .prose li {
            color: var(--text-secondary);
            line-height: 1.8;
        }
        .prose strong {
             color: var(--text-primary);
        }

        /* --- Interactive Demo Card --- */
        .interactive-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-top: 2rem;
            box-shadow: 0 8px 16px var(--shadow-color);
            overflow: hidden;
        }
        .interactive-card__header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .interactive-card__header h4 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--text-primary);
        }
        .interactive-card__body {
            padding: 1.5rem;
        }
        .interactive-card__body--grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            .interactive-card__body--grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- Buttons --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        .btn-primary {
            background-color: var(--brand-blue);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(14, 165, 233, 0.25);
        }
        .btn-primary:hover {
            background-color: #0b94d1;
            transform: translateY(-1px);
        }
        .btn-danger {
            background-color: var(--brand-red);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(221, 0, 49, 0.25);
        }
        .btn-danger:hover {
            background-color: #c5002b;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }
        .btn-secondary:hover {
            background-color: #f1f5f9;
            border-color: #cbd5e1;
        }

        /* --- Code Blocks --- */
        pre {
            background-color: var(--bg-code);
            border-radius: 10px;
            padding: 1.5rem;
            position: relative;
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.3);
        }
        pre code {
            font-family: 'SF Mono', 'Fira Code', 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-code);
        }
        .copy-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: #334155;
            color: #94a3b8;
            border: 1px solid #475569;
            border-radius: 6px;
            padding: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .copy-btn:hover {
            color: #e2e8f0;
            background: #475569;
        }

        /* --- Callouts --- */
        .callout {
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
            border-right-width: 4px;
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }
        .callout-info { background-color: #f0f9ff; border-color: var(--brand-blue); }
        .callout-warning { background-color: #fffbeb; border-color: #f59e0b; }
        .callout p { margin: 0; }

        /* --- On-screen Terminal --- */
        .terminal {
            background-color: var(--bg-code);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.875rem;
            margin-top: 1rem;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }
        .terminal__header {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #334155;
        }
        .terminal__dot { width: 12px; height: 12px; border-radius: 50%; }
        .terminal__body {
            height: 150px;
            overflow-y: auto;
            padding-top: 0.5rem;
            color: #94a3b8;
        }
        .terminal__body p {
            margin: 0; padding: 0.125rem 0; display: flex; align-items: center; gap: 0.5rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .log-prompt { color: var(--brand-green); }
        .log-computed { color: var(--brand-blue); }
        .log-effect { color: var(--brand-purple); }
        .log-info { color: #64748b; }
        
        /* --- Accordion --- */
        .accordion-item { border-bottom: 1px solid var(--border-color); }
        .accordion-header {
            cursor: pointer;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .accordion-content div { padding: 0 1.25rem 1.25rem; }
        .accordion-icon { transition: transform 0.3s ease; }
        
        /* --- Input Fields --- */
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            background: white;
            transition: all 0.2s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--brand-blue);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }

        /* Code Blocks and Syntax Highlighting */
        pre[class*="language-"] {
            direction: ltr !important;
            text-align: left !important;
            tab-size: 2;
            background: var(--bg-code) !important;
            border-radius: 0.5rem;
            padding: 1.5rem !important;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        code[class*="language-"] {
            font-family: 'Fira Code', monospace !important;
            color: var(--text-code) !important;
            font-size: 0.9rem !important;
            line-height: 1.7;
        }

        /* Angular-specific syntax highlighting */
        .token.decorator {
            color: #50fa7b !important; /* Angular decorators */
        }

        .token.class-name {
            color: #8be9fd !important; /* Class names */
        }

        .token.function {
            color: #50fa7b !important; /* Functions and methods */
        }

        .token.keyword {
            color: #ff79c6 !important; /* TypeScript keywords */
        }

        .token.string {
            color: #f1fa8c !important; /* Strings */
        }

        .token.property {
            color: #bd93f9 !important; /* Object properties */
        }

        .token.punctuation {
            color: #6272a4 !important; /* Punctuation */
        }

        .token.operator {
            color: #ff79c6 !important; /* Operators */
        }

        .token.comment {
            color: #6272a4 !important; /* Comments */
        }

        /* Angular Template Syntax */
        .token.tag {
            color: #ff79c6 !important; /* HTML tags */
        }

        .token.attr-name {
            color: #50fa7b !important; /* Attributes */
        }

        .token.attr-value {
            color: #f1fa8c !important; /* Attribute values */
        }

        /* Angular specific template syntax */
        .token.interpolation {
            color: #bd93f9 !important; /* {{ }} interpolation */
        }

        .token.directive {
            color: #50fa7b !important; /* Angular directives */
        }

        /* Code block line numbers */
        .line-numbers-rows > span:before {
            color: #6272a4 !important;
            text-align: right !important;
            padding-right: 0.8em !important;
        }

        /* Example headings */
        .example-heading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .example-heading::before {
            content: "📝";
            font-size: 1.25rem;
        }

        /* Example output */
        .example-output {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* Main content alignment */
        .prose {
            max-width: 140ch !important;
            margin: 0 auto;
            padding: 2rem;
        }

        .prose pre {
            direction: ltr !important;
            text-align: left !important;
        }

        /* Angular component example blocks */
        .angular-component {
            background: var(--bg-code);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin: 1.5rem 0;
        }

        .angular-component__header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-code);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .angular-component pre {
            margin: 0 !important;
            border-radius: 0 0 0.5rem 0.5rem;
        }

        /* Footer styling */
        .footer {
            background-color: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            padding: 2rem;
            margin-top: 4rem;
            text-align: center;
        }

        .footer-content {
            max-width: 140ch;
            margin: 0 auto;
        }

        .developer-info {
            margin-bottom: 1.5rem;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .social-links a:hover {
            color: var(--brand-red);
        }

        .reference {
            margin-top: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="bg-bg-secondary">

    <!-- Mobile Header and Sidebar Toggle -->
    <header class="md:hidden sticky top-0 z-20 flex items-center justify-between p-4 bg-bg-primary shadow-md">
        <h1 class="text-xl font-bold">دليل Signals</h1>
        <button id="sidebar-toggle" class="p-2 rounded-md">
            <i data-lucide="menu"></i>
        </button>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-72 fixed md:sticky top-0 h-screen p-4 shadow-lg z-30 md:transform-none overflow-y-auto">
            <h1 class="hidden md:block text-2xl font-bold text-gray-800 mb-6 border-b-2 pb-3 border-border-color">
                <span class="text-brand-red">Angular</span> Signals
            </h1>
            <nav class="flex flex-col space-y-1">
                <a href="#intro" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="zap" class="w-4 h-4"></i>مقدمة: ما هي السيجنالز؟</a>
                
                <h3 class="font-bold mt-4 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider">الأساسيات</h3>
                <a href="#creating-signals" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="plus-circle" class="w-4 h-4"></i>إنشاء سيجنال</a>
                <a href="#reading-signals" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="eye" class="w-4 h-4"></i>قراءة السيجنال</a>
                <a href="#updating-signals" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="edit" class="w-4 h-4"></i>تحديث السيجنال</a>
                
                <h3 class="font-bold mt-4 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider">المفاهيم الأساسية</h3>
                <a href="#computed-signals" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="function-square" class="w-4 h-4"></i>الحالة المشتقة (`computed`)</a>
                <a href="#effects" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="cpu" class="w-4 h-4"></i>الآثار الجانبية (`effect`)</a>
                
                <h3 class="font-bold mt-4 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider">مفاهيم متقدمة</h3>
                <a href="#readonly" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="shield-check" class="w-4 h-4"></i>سيجنال للقراءة فقط</a>
                <a href="#encapsulation" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="lock" class="w-4 h-4"></i>نمط تغليف الحالة</a>
                <a href="#equal-function" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="scale" class="w-4 h-4"></i>التحكم في المقارنة (`equal`)</a>

                <h3 class="font-bold mt-4 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider">أنماط عملية</h3>
                <a href="#state-management" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="share-2" class="w-4 h-4"></i>إدارة الحالة العامة</a>
                <a href="#data-fetching" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="database" class="w-4 h-4"></i>جلب البيانات الديناميكي</a>

                <h3 class="font-bold mt-4 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider">أسئلة شائعة</h3>
                <a href="#faq" class="sidebar-link p-3 rounded-md flex items-center gap-3"><i data-lucide="help-circle" class="w-4 h-4"></i>أسئلة وإجابات</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="w-full p-6 md:p-12 prose">
            
            <section id="intro">
                <h2>مقدمة: ما هي السيجنالز؟</h2>
                <p>
                    قبل أن نتعمق في الكود، دعنا نبسط الفكرة الأساسية. تخيل أن كل قطعة بيانات متغيرة في تطبيقك هي "صندوق" ذكي. هذا الصندوق لا يحمل القيمة فقط، بل يمتلك أيضاً "جهاز إرسال" و"جهاز استقبال"، وهو التشبيه الرائع الذي تم استخدامه في الورشة.
                </p>
                <div class="grid md:grid-cols-2 gap-6 mt-8 not-prose">
                    <div class="p-6 bg-bg-primary rounded-xl shadow-lg border border-border-color">
                        <div class="flex items-center gap-4">
                             <div class="p-3 bg-blue-100 rounded-full"><i data-lucide="arrow-up-right" class="w-6 h-6 text-brand-blue"></i></div>
                             <h3 class="font-bold text-xl m-0">جهاز الإرسال (Transmitter)</h3>
                        </div>
                        <p class="text-text-secondary mt-4">عندما تتغير القيمة داخل الصندوق، يقوم جهاز الإرسال بإعلام كل من يهتم بهذه القيمة بشكل فوري.</p>
                    </div>
                    <div class="p-6 bg-bg-primary rounded-xl shadow-lg border border-border-color">
                        <div class="flex items-center gap-4">
                             <div class="p-3 bg-green-100 rounded-full"><i data-lucide="arrow-down-left" class="w-6 h-6 text-brand-green"></i></div>
                             <h3 class="font-bold text-xl m-0">جهاز الاستقبال (Receiver)</h3>
                        </div>
                        <p class="text-text-secondary mt-4">في كل مكان يتم استخدام هذه القيمة، يوجد جهاز استقبال "يستمع" لأي تغييرات. فور وصول إشارة التغيير، يتم تحديث الواجهة أو تنفيذ منطق برمجي معين بشكل تلقائي.</p>
                    </div>
                </div>
                 <p class="mt-8">
                   هذه هي قوة الـ **"Reactivity"** أو **"التفاعلية"** التي تقدمها السيجنالز: نظام فعال ودقيق لمعرفة <strong>ماذا تغير</strong> و <strong>أين يجب أن يتم التحديث</strong>، وذلك بأقل مجهود ممكن وبأداء عالٍ جداً.
                </p>
            </section>

            <hr class="my-12 border-border-color">

            <section id="creating-signals">
                <h2>1.1 إنشاء سيجنال (`signal`)</h2>
                <p>لإنشاء سيجنال، نستخدم دالة `signal()` التي يتم استيرادها من `@angular/core`. نمرر القيمة الأولية كوسيط لهذه الدالة.</p>
                <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>import { Component, signal } from '@angular/core';

@Component({ /* ... */ })
export class AppComponent {
  // إنشاء سيجنال من نوع string
  pageTitle = signal&lt;string&gt;('مرحباً بالسيجنالز!');

  // إنشاء سيجنال من نوع number (سيتم استنتاج النوع)
  userCount = signal(50);

  // إنشاء سيجنال يحتوي على object
  user = signal({ name: 'علي', loggedIn: true });
}</code></pre>
                <div class="callout callout-info">
                    <i data-lucide="lightbulb" class="w-5 h-5 text-brand-blue flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="font-bold text-lg m-0 mb-1 text-text-primary">ملاحظة</h4>
                        <p>أنجلولار ذكي بما يكفي لاستنتاج النوع (Type Inference) في معظم الحالات، لكن من الممارسة الجيدة تحديد النوع بشكل صريح (`<string>`)، خاصة مع الكائنات المعقدة لضمان سلامة الأنواع (Type Safety).</p>
                    </div>
                </div>
            </section>
            
             <hr class="my-12 border-border-color">

            <section id="reading-signals">
                <h2>1.2 قراءة السيجنال</h2>
                <p>لقراءة القيمة المخزنة داخل سيجنال، نتعامل مع السيجنال كأنها دالة ونستدعيها باستخدام الأقواس `()`. هذا ينطبق سواء في كود TypeScript أو في قوالب HTML.</p>
                <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>// في الكلاس
logTitle() {
  // لقراءة القيمة، نستخدم pageTitle()
  console.log(this.pageTitle()); // "مرحباً بالسيجنالز!"
}

// في القالب (Template)
// يتم استدعاؤها أيضاً بالأقواس
&lt;h2&gt;المستخدم الحالي: {{ user().name }}&lt;/h2&gt;
</code></pre>
            </section>
            
             <hr class="my-12 border-border-color">

             <section id="updating-signals">
                <h2>1.3 تحديث السيجنال (`set` & `update`)</h2>
                <p>هناك طريقتان رئيسيتان لتحديث السيجنال، واختيار الطريقة المناسبة يعتمد على طبيعة التحديث الذي تريد القيام به.</p>
                <h3 class="mt-8">1. `set()`: الاستبدال الكامل</h3>
                <p>تستخدم `set()` لاستبدال القيمة القديمة بالكامل بقيمة جديدة. هي مناسبة للقيم الأولية (Primitives) أو عندما تريد تغيير الكائن بأكمله.</p>
                <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>updateTitle() {
  this.pageTitle.set('عنوان جديد كلياً!');
}</code></pre>

                <h3 class="mt-8">2. `update()`: التحديث المعتمد على القيمة السابقة</h3>
                <p>تستخدم `update()` عندما تحتاج إلى تعديل القيمة بناءً على حالتها السابقة. تأخذ دالة كوسيط، وهذه الدالة تستقبل القيمة الحالية (`current`) وتعيد القيمة الجديدة. هذا ضروري بشكل خاص للكائنات والمصفوفات لتجنب فقدان البيانات.</p>
                <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>incrementCount() {
  // نأخذ القيمة الحالية (current) ونضيف عليها 1
  this.userCount.update(current => current + 1);
}

// مثال مع كائن (object)
logoutUser() {
  this.user.update(currentUser => {
    // نستخدم spread operator (...) للحفاظ على باقي الخصائص
    return { ...currentUser, loggedIn: false };
  });
}</code></pre>

                <div class="interactive-card not-prose">
                    <div class="interactive-card__header"><h4>تجربة حية: تحديث السيجنالز</h4></div>
                    <div class="interactive-card__body space-y-6">
                        <div class="p-4 border border-border-color rounded-lg">
                            <p><strong>العنوان (باستخدام `set`):</strong> <span id="demo-title" class="font-bold text-brand-blue"></span></p>
                            <button id="btn-set-title" class="btn btn-primary mt-3">غير العنوان</button>
                        </div>
                        <div class="p-4 border border-border-color rounded-lg">
                            <p><strong>العداد (باستخدام `update`):</strong> <span id="demo-counter" class="font-bold text-brand-green"></span></p>
                            <button id="btn-update-counter" class="btn btn-primary mt-3">زيادة العداد</button>
                        </div>
                        <div class="p-4 border border-border-color rounded-lg">
                            <p><strong>حالة المستخدم (باستخدام `update` لكائن):</strong> <span id="demo-user-status" class="font-bold text-brand-red"></span></p>
                            <button id="btn-toggle-login" class="btn btn-primary mt-3">تبديل حالة الدخول</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr class="my-12 border-border-color">
            
            <section id="computed-signals">
                 <h2>2. الحالة المشتقة (`computed`)</h2>
                 <p>الـ `computed` سيجنال هي سيجنال **للقراءة فقط**، تُشتق قيمتها من سيجنال واحد أو أكثر. يتم إعادة حساب قيمتها تلقائياً فقط عند تغير أي من السيجنالز التي تعتمد عليها.</p>
                <div class="interactive-card not-prose">
                    <div class="interactive-card__header"><h4>تجربة حية: `computed`</h4></div>
                    <div class="interactive-card__body interactive-card__body--grid">
                        <div class="space-y-4">
                            <div>
                                <label class="font-semibold">العداد الأصلي:</label>
                                <div class="flex items-center gap-3 mt-2">
                                    <button id="btn-computed-inc" class="btn btn-primary w-12">+</button>
                                    <span id="computed-original" class="text-2xl font-bold w-12 text-center"></span>
                                    <button id="btn-computed-dec" class="btn btn-danger w-12">-</button>
                                </div>
                            </div>
                            <hr class="border-border-color">
                            <div>
                                <p class="font-semibold">قيمة مشتقة 1:</p>
                                <p><strong>`double` = </strong><span id="computed-double" class="font-bold text-brand-blue text-lg"></span></p>
                            </div>
                             <div>
                                <p class="font-semibold">قيمة مشتقة 2:</p>
                                <p><strong>`isEven` = </strong><span id="computed-iseven" class="font-bold text-brand-green text-lg"></span></p>
                            </div>
                        </div>
                        <div class="terminal">
                            <div class="terminal__header">
                                <div class="terminal__dot bg-red-500"></div>
                                <div class="terminal__dot bg-yellow-500"></div>
                                <div class="terminal__dot bg-green-500"></div>
                            </div>
                            <div class="terminal__body" id="computed-console"></div>
                        </div>
                    </div>
                </div>
            </section>

             <hr class="my-12 border-border-color">
            
            <section id="effects">
                 <h2>3. الآثار الجانبية (`effect`)</h2>
                 <p>الـ `effect` هي عملية يتم تنفيذها كلما تغيرت قيمة أي سيجنال مستخدم بداخلها. هي مخصصة للآثار الجانبية (Side Effects) التي لا علاقة لها مباشرةً برسم الواجهة.</p>
                  <div class="callout callout-warning">
                    <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-500 flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="font-bold text-lg m-0 mb-1 text-text-primary">تحذير</h4>
                        <p>لا تقم بتعديل أي سيجنال داخل `effect` إلا بحذر شديد، فقد يؤدي ذلك إلى حلقة لا نهائية (infinite loop). الـ `effect` يجب أن يكون نقطة نهاية التفاعل، وليس بداية تفاعل جديد.</p>
                    </div>
                </div>
                 <div class="interactive-card not-prose">
                    <div class="interactive-card__header"><h4>تجربة حية: `effect`</h4></div>
                    <div class="interactive-card__body interactive-card__body--grid">
                        <div class="space-y-4">
                            <div>
                                <p><strong>معرف المستخدم (متتبع):</strong> <span id="effect-userid" class="font-bold"></span></p>
                                 <button id="btn-effect-changeuser" class="btn btn-primary mt-2">غير المستخدم</button>
                            </div>
                            <div>
                                <p><strong>العداد (قد يكون غير متتبع):</strong> <span id="effect-counter" class="font-bold"></span></p>
                                 <button id="btn-effect-inccounter" class="btn btn-primary mt-2">زيادة العداد</button>
                            </div>
                             <div class="mt-2 flex items-center p-3 bg-bg-secondary rounded-lg">
                                <input type="checkbox" id="untrack-checkbox" class="ml-2 h-4 w-4 rounded">
                                <label for="untrack-checkbox" class="text-text-secondary">استخدم `untracked` على العداد</label>
                            </div>
                        </div>
                        <div class="terminal">
                            <div class="terminal__header">
                                <div class="terminal__dot bg-red-500"></div><div class="terminal__dot bg-yellow-500"></div><div class="terminal__dot bg-green-500"></div>
                            </div>
                            <div class="terminal__body" id="effect-console"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr class="my-12 border-border-color">
            
            <section id="readonly">
                <h2>4.1 سيجنال للقراءة فقط (`asReadonly`)</h2>
                <p>في بعض الأحيان، تريد عرض حالة (State) للعالم الخارجي (مكونات أخرى) دون السماح لهم بتعديلها مباشرة. هنا يأتي دور `.asReadonly()` الذي يعطيك نسخة من السيجنال يمكن قراءتها فقط، بدون دوال `set` أو `update`.</p>
                <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>// داخل سيرفس أو مكون أب
private _state = signal({ count: 0 });

// نعرض نسخة للقراءة فقط للعالم الخارجي
public readonly state = this._state.asReadonly();

// طرق التعديل تبقى خاصة داخل السيرفس
public increment() {
    this._state.update(s => ({ ...s, count: s.count + 1 }));
}
</code></pre>
                 <div class="callout callout-warning">
                    <i data-lucide="shield-alert" class="w-5 h-5 text-yellow-500 flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="font-bold text-lg m-0 mb-1 text-text-primary">ملاحظة هامة</h4>
                        <p>كما ذكر في الورشة، `asReadonly()` يمنع استدعاء `.set()` و `.update()`, لكنه لا يمنع إعادة تعيين المتغير نفسه (`state = signal(...)`) إذا لم يكن `readonly` في TypeScript. لهذا السبب، النمط التالي (تغليف الحالة) يعتبر أكثر أماناً وقوة.</p>
                    </div>
                </div>
            </section>

             <hr class="my-12 border-border-color">

            <section id="encapsulation">
                <h2>4.2 نمط تغليف الحالة (State Encapsulation)</h2>
                <p>هذا هو النمط المفضل والأكثر أماناً لمشاركة الحالة، خاصة عند بناء Services. الفكرة هي إخفاء السيجنال القابل للكتابة (writable signal) كخاصية خاصة (private)، وعرض قيمته فقط عبر `computed` signal أو دالة getter.</p>
                <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>// في StateService.ts
import { signal, computed, Injectable } from '@angular/core';

@Injectable({ providedIn: 'root' })
export class StateService {

  // 1. السيجنال الأصلي خاص ولا يمكن الوصول إليه من الخارج
  private state = signal({ user: 'Guest', theme: 'light' });

  // 2. عرض أجزاء من الحالة كـ computed signals للقراءة فقط
  public currentUser = computed(() => this.state().user);
  public currentTheme = computed(() => this.state().theme);

  // 3. توفير دوال عامة (public) لتعديل الحالة بشكل آمن
  public login(userName: string) {
    this.state.update(s => ({ ...s, user: userName }));
  }

  public toggleTheme() {
    this.state.update(s => ({ ...s, theme: s.theme === 'light' ? 'dark' : 'light' }));
  }
}</code></pre>
                <p>بهذه الطريقة، المكونات الأخرى لا يمكنها تعديل الحالة إلا عبر الدوال المخصصة لذلك، مما يضمن أن التغييرات تحدث بطريقة متوقعة ومنظمة.</p>
            </section>

            <hr class="my-12 border-border-color">

            <section id="equal-function">
                <h2>4.3 التحكم في المقارنة (`equal`)</h2>
                <p>افتراضياً، تستخدم السيجنالز مقارنة صارمة (`===`) لمعرفة ما إذا كانت القيمة الجديدة مختلفة. لكن في بعض الحالات، قد تريد تعريف منطق مقارنة خاص بك. يمكنك فعل ذلك عبر خاصية `equal` عند إنشاء السيجنال.</p>
                <p>المثال الذي تم شرحه: منع التحديثات إذا كان التغيير فقط في حالة الأحرف (case).</p>
                 <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>name = signal('Mostafa', {
  // دالة المقارنة تأخذ القيمة القديمة (a) والجديدة (b)
  equal: (a, b) => a.toLowerCase() === b.toLowerCase() 
});

// سيجنال مشتق سيتأثر فقط عند تغير الاسم فعلياً (وليس فقط حالة الأحرف)
welcomeMessage = computed(() => `Welcome, ${this.name()}!`);
</code></pre>
                <div class="interactive-card not-prose">
                    <div class="interactive-card__header"><h4>تجربة حية: دالة `equal`</h4></div>
                    <div class="interactive-card__body interactive-card__body--grid">
                         <div class="space-y-4">
                            <div>
                                <label for="equal-input" class="font-semibold">أدخل اسماً:</label>
                                <input type="text" id="equal-input" class="form-input mt-2">
                            </div>
                            <hr class="border-border-color">
                             <div>
                                <p class="font-semibold">الرسالة الترحيبية (مشتقة):</p>
                                <p id="equal-output" class="font-bold text-brand-blue text-lg"></p>
                             </div>
                         </div>
                         <div class="terminal">
                            <div class="terminal__header">
                                <div class="terminal__dot bg-red-500"></div><div class="terminal__dot bg-yellow-500"></div><div class="terminal__dot bg-green-500"></div>
                            </div>
                            <div class="terminal__body" id="equal-console"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr class="my-12 border-border-color">
            
            <section id="state-management">
                <h2>5.1 نمط عملي: إدارة الحالة العامة</h2>
                <p>يمكن للسيجنالز أن تكون بديلاً قوياً وبسيطاً لمكتبات إدارة الحالة المعقدة مثل NgRx في العديد من التطبيقات. الفكرة هي إنشاء Service مركزي يحمل الحالة كمجموعة من السيجنالز.</p>
                <p>في هذا المثال، لدينا "مكونان" على نفس الصفحة يقرآن ويعدلان نفس الحالة المشتركة من سيرفس وهمي. لاحظ كيف أن تغيير الحالة من أي مكون ينعكس فوراً على الآخر.</p>
                <div class="interactive-card not-prose">
                    <div class="interactive-card__header"><h4>تجربة حية: حالة مشتركة بين المكونات</h4></div>
                    <div class="interactive-card__body interactive-card__body--grid">
                        <!-- Component A -->
                        <div class="p-6 border border-border-color rounded-lg bg-bg-secondary">
                            <h5 class="font-bold text-lg text-text-primary flex items-center gap-2"><i data-lucide="layout-dashboard" class="text-brand-blue"></i>المكون (أ): لوحة التحكم</h5>
                            <p class="mt-4 text-text-secondary">المستخدم الحالي: <strong id="comp-a-user" class="text-brand-blue"></strong></p>
                            <p class="text-text-secondary">المظهر الحالي: <strong id="comp-a-theme" class="text-brand-purple"></strong></p>
                            <button id="btn-comp-a-login" class="btn btn-primary mt-4">تسجيل دخول "أحمد"</button>
                        </div>
                        <!-- Component B -->
                        <div class="p-6 border border-border-color rounded-lg bg-bg-secondary">
                            <h5 class="font-bold text-lg text-text-primary flex items-center gap-2"><i data-lucide="chrome" class="text-brand-green"></i>المكون (ب): شريط العلوي</h5>
                             <p class="mt-4 text-text-secondary">مرحباً, <strong id="comp-b-user" class="text-brand-blue"></strong>!</p>
                             <p class="text-text-secondary">المظهر: <strong id="comp-b-theme" class="text-brand-purple"></strong></p>
                            <button id="btn-comp-b-theme" class="btn btn-primary mt-4">تغيير المظهر</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr class="my-12 border-border-color">
            
            <section id="data-fetching">
                <h2>5.2 نمط عملي: جلب البيانات الديناميكي</h2>
                <p>هذا واحد من أقوى أنماط الاستخدام. يمكننا وضع كل متغيرات جلب البيانات (مثل الصفحة الحالية، الفلاتر، مفتاح البحث) في سيجنال واحد. ثم نستخدم `effect` لمراقبة هذا السيجنال، وفي كل مرة يتغير أي جزء منه، يتم استدعاء API لجلب البيانات المحدثة تلقائياً.</p>
                <div class="interactive-card not-prose">
                     <div class="interactive-card__header"><h4>تجربة حية: جلب بيانات الجدول</h4></div>
                     <div class="interactive-card__body">
                        <div class="flex flex-col md:flex-row flex-wrap gap-6 items-center p-4 bg-bg-secondary rounded-lg">
                            <div class="flex items-center gap-2">
                                <label class="font-semibold text-text-secondary">الصفحة:</label>
                                <button id="btn-fetch-prev" class="btn btn-secondary w-10">-</button>
                                <span id="fetch-page-display" class="font-bold text-lg w-8 text-center">1</span>
                                <button id="btn-fetch-next" class="btn btn-secondary w-10">+</button>
                            </div>
                             <div class="flex items-center gap-2">
                                <label for="fetch-filter" class="font-semibold text-text-secondary">فلتر:</label>
                                <select id="fetch-filter" class="form-input w-40">
                                    <option value="all">الكل</option>
                                    <option value="active">النشطين</option>
                                    <option value="inactive">غير النشطين</option>
                                </select>
                            </div>
                        </div>
                         <div class="terminal mt-6">
                            <div class="terminal__header">
                                <div class="terminal__dot bg-red-500"></div><div class="terminal__dot bg-yellow-500"></div><div class="terminal__dot bg-green-500"></div>
                            </div>
                            <div class="terminal__body" id="fetch-console"></div>
                        </div>
                         <div id="fetch-results" class="mt-6 p-4 border border-border-color rounded-lg bg-bg-secondary min-h-[100px]">
                            <!-- Results will be displayed here -->
                        </div>
                     </div>
                </div>
            </section>
            
            <hr class="my-12 border-border-color">
            
            <section id="faq">
                 <h2>6. أسئلة شائعة (FAQ)</h2>
                 <div class="accordion w-full bg-bg-primary rounded-lg shadow-md mt-6 not-prose">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <span>هل السيجنالز بديل لـ RxJS؟</span>
                            <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                        </div>
                        <div class="accordion-content">
                             <div class="prose max-w-none"><p><strong>الإجابة المختصرة: لا.</strong></p> <p>هما يحلان مشاكل مختلفة ويكملان بعضهما البعض.</p> <ul><li><strong>السيجنالز (`Signals`)</strong>: مصممة لإدارة الحالة (State-based). هي ممتازة في تمثيل القيم التي تتغير بمرور الوقت وكيف تتفاعل الواجهة مع هذه التغييرات. هي تعرف دائماً "القيمة الحالية".</li><li><strong>RxJS</strong>: مصممة للتعامل مع الأحداث (Event-based). هي قوية جداً في التعامل مع تدفقات الأحداث غير المتزامنة بمرور الوقت (مثل نقرات المستخدم، استجابات WebSocket، الأحداث المعقدة). هي تتعامل مع "أحداث" تحدث، وليس بالضرورة أن يكون لها "قيمة حالية".</li></ul><p>أفضل ممارسة هي استخدامهما معاً. يمكنك استخدام القوة الكاملة لـ RxJS للتعامل مع الأحداث المعقدة، ثم تحويل النتيجة النهائية إلى سيجنال (`toSignal`) لعرضها بسهولة في الواجهة.</p></div>
                        </div>
                    </div>
                     <div class="accordion-item">
                        <div class="accordion-header">
                            <span>متى يجب أن أستخدم NgRx إذن؟</span>
                             <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="prose max-w-none"><p>مع وجود السيجنالز، أصبحت الحاجة لـ NgRx أقل بكثير في معظم التطبيقات. ومع ذلك، لا يزال NgRx قوياً جداً في سيناريوهات محددة ومعقدة جداً:</p><ul><li><strong>التطبيقات الضخمة (Enterprise-level):</strong> عندما يكون لديك حالة معقدة جداً ومنطق أعمال متداخل، يوفر NgRx هيكلاً صارماً (Actions, Reducers, Effects) يفرض نمطاً موحداً على الفريق بأكمله.</li><li><strong>التدقيق المتقدم (Advanced Auditing):</strong> أدوات مثل NgRx DevTools قوية جداً لتتبع كل تغيير في الحالة حدث في التطبيق، مما يسهل تصحيح الأخطاء في الأنظمة المعقدة.</li><li><strong>عند العمل على منصة (Platform):</strong> كما ذكر في الورشة، إذا كنت تبني منصة تحتوي على عدة تطبيقات صغيرة تتشارك في حالة مركزية، فإن NgRx يوفر حلاً قوياً لتوحيد هذه الحالة.</li></ul><p><strong>القاعدة العامة:</strong> ابدأ بالسيجنالز. إذا وجدت أن إدارة الحالة أصبحت فوضوية ومعقدة جداً، وقتها فقط فكر في الانتقال إلى NgRx.</p></div>
                        </div>
                    </div>
                     <div class="accordion-item">
                        <div class="accordion-header">
                            <span>ماذا عن النماذج (Forms)؟ هل يمكن استخدام السيجنالز معها؟</span>
                             <i data-lucide="chevron-down" class="accordion-icon w-5 h-5"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="prose max-w-none"><p>نعم، والمستقبل يبدو مشرقاً جداً في هذه النقطة! حالياً، يمكنك ربط النماذج الحالية (Reactive Forms) بالسيجنالز يدوياً، ولكن هذا يتطلب بعض الكود الإضافي. </p><p><strong>الخبر السار:</strong> فريق أنجلولار يعمل حالياً على "Signal-based Forms". هذا يعني أنه في المستقبل القريب، سيكون هناك API جديد للنماذج مبني بالكامل على السيجنالز، مما سيجعل الكود أبسط وأكثر تفاعلية وأسهل في التعامل معه. ترقب التحديثات القادمة من فريق أنجلولار!</p></div>
                        </div>
                    </div>
                 </div>
            </section>
        </main>
    </div>
    
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

    <footer class="footer">
        <div class="footer-content">
            <div class="developer-info">
                <h3 class="text-xl font-semibold mb-2">تم تطوير هذا الموقع بواسطة</h3>
                <p class="text-lg font-medium text-brand-red">Kareem Taha</p>
            </div>
            <div class="social-links">
                <a href="https://www.facebook.com/kareem.taha.628786" target="_blank" rel="noopener noreferrer" title="Facebook">
                    <i data-lucide="facebook"></i>
                </a>
                <a href="https://www.linkedin.com/in/kareem-taha-31416634b/" target="_blank" rel="noopener noreferrer" title="LinkedIn">
                    <i data-lucide="linkedin"></i>
                </a>
            </div>
            <div class="reference">
                <p>المحتوى مستوحى من قناة <a href="https://www.youtube.com/watch?v=16hCJoSB6bE" target="_blank" rel="noopener noreferrer" class="text-brand-red hover:underline">Angular Egypt</a></p>
            </div>
        </div>
    </footer>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
