<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>الدليل التفاعلي لـ Angular Signals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      :root {
        --brand-red: #e11d48;
        --brand-primary: #6366f1; /* New Primary Color (Indigo) */
        --brand-primary-light: #818cf8;
        --brand-green: #22c55e;
        --brand-purple: #a855f7;
        --bg-primary: #ffffff;
        --bg-secondary: #f7f8fa; /* Slightly cooler background */
        --bg-code: #0f172a;
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --text-code: #e2e8f0;
        --border-color: #e2e8f0;
        --shadow-color: rgba(
          99,
          102,
          241,
          0.1
        ); /* Shadow tied to primary color */
        --shadow-color-light: rgba(149, 157, 165, 0.08);
      }

      .dark {
        --bg-primary: #1e293b;
        --bg-secondary: #0f172a;
        --bg-code: #020617;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --border-color: #334155;
        --shadow-color: rgba(99, 102, 241, 0.15);
        --shadow-color-light: rgba(0, 0, 0, 0.1);
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: "IBM Plex Sans Arabic", sans-serif;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* --- Sidebar --- */
      #sidebar {
        background-color: var(--bg-primary);
        transition: transform 0.3s ease-in-out;
        border-left: 1px solid var(--border-color);
      }
      .sidebar-link {
        transition: all 0.2s ease;
        border-right: 3px solid transparent;
        color: var(--text-secondary);
      }
      .sidebar-link:hover {
        background-color: var(--bg-secondary);
        color: var(--brand-primary);
      }
      .sidebar-link.active {
        background-color: var(--bg-secondary);
        color: var(--brand-red);
        font-weight: 600;
        border-right-color: var(--brand-red);
      }
      #sidebar-toggle {
        background: transparent;
        color: var(--text-secondary);
      }
      @media (max-width: 768px) {
        #sidebar {
          transform: translateX(100%);
        }
        #sidebar.open {
          transform: translateX(0);
        }
      }

      /* --- Main Content --- */
      main.prose {
        max-width: 80ch;
      }
      .prose h1,
      .prose h2,
      .prose h3,
      .prose h4 {
        color: var(--text-primary);
        font-weight: 700;
      }
      .prose h2 {
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.75rem;
        margin-bottom: 2rem;
      }
      .prose p,
      .prose ul,
      .prose li {
        color: var(--text-secondary);
        line-height: 1.9;
      }
      .prose strong {
        color: var(--text-primary);
        font-weight: 600;
      }
      .prose code {
        background-color: var(--bg-secondary);
        color: var(--brand-red);
        font-family: "SF Mono", "Fira Code", monospace;
        padding: 0.2rem 0.4rem;
        border-radius: 6px;
        font-size: 0.9em;
      }

      /* --- Interactive Demo Card --- */
      .interactive-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        margin-top: 2rem;
        box-shadow: 0 4px 12px var(--shadow-color-light);
        overflow: hidden;
        border-top: 4px solid var(--brand-primary);
      }
      .interactive-card__header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        background-color: var(--bg-secondary);
      }
      .interactive-card__header h4 {
        margin: 0;
        font-size: 1.25rem;
        color: var(--text-primary);
      }
      .interactive-card__body {
        padding: 1.5rem;
      }
      .interactive-card__body--grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      @media (min-width: 768px) {
        .interactive-card__body--grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* --- Buttons --- */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.6rem 1.25rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        -webkit-font-smoothing: antialiased;
      }
      .btn:focus-visible {
        outline: 2px solid var(--brand-primary);
        outline-offset: 2px;
      }
      .btn-primary {
        background-color: var(--brand-primary);
        color: white;
        box-shadow: 0 4px 14px 0 var(--shadow-color);
      }
      .btn-primary:hover {
        background-color: var(--brand-primary-light);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px 0 var(--shadow-color);
      }
      .btn-danger {
        background-color: var(--brand-red);
        color: white;
        box-shadow: 0 4px 14px 0 rgba(221, 0, 49, 0.25);
      }
      .btn-danger:hover {
        background-color: #c5002b;
        transform: translateY(-2px);
      }
      .btn-secondary {
        background-color: var(--bg-primary);
        color: var(--text-secondary);
        border-color: var(--border-color);
      }
      .btn-secondary:hover {
        background-color: var(--bg-secondary);
        border-color: #cbd5e1;
        color: var(--text-primary);
      }

      /* --- Code Blocks --- */
      pre {
        background-color: var(--bg-code);
        border-radius: 12px;
        padding: 1.5rem;
        position: relative;
        box-shadow: 0 10px 30px rgba(2, 6, 23, 0.4);
        border: 1px solid #1e293b;
      }
      pre code {
        font-family: "SF Mono", "Fira Code", "IBM Plex Mono", monospace;
        font-size: 0.9rem;
        color: var(--text-code);
      }
      .copy-btn {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: rgba(51, 65, 85, 0.7);
        color: #94a3b8;
        border: 1px solid #475569;
        border-radius: 6px;
        padding: 0.35rem;
        cursor: pointer;
        backdrop-filter: blur(4px);
        transition: all 0.2s ease;
      }
      .copy-btn:hover {
        color: #e2e8f0;
        background: #475569;
      }

      /* --- Callouts --- */
      .callout {
        padding: 1rem 1.5rem;
        margin: 1.5rem 0;
        border-radius: 8px;
        border-right-width: 4px;
        display: flex;
        align-items: start;
        gap: 1rem;
      }
      .callout-info {
        background-color: #eff6ff;
        border-color: var(--brand-primary);
        color: #374151;
      }
      .callout-warning {
        background-color: #fffbeb;
        border-color: #f59e0b;
        color: #374151;
      }
      .dark .callout-info {
        background-color: #1e293b;
        border-color: var(--brand-primary);
      }
      .dark .callout-warning {
        background-color: #3b301a;
        border-color: #f59e0b;
      }
      .callout p {
        margin: 0;
        color: inherit;
      }

      /* --- On-screen Terminal --- */
      .terminal {
        background-color: var(--bg-code);
        border: 1px solid #334155;
        border-radius: 12px;
        padding: 1rem;
        font-family: "SF Mono", "Fira Code", monospace;
        font-size: 0.875rem;
        margin-top: 1rem;
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
      }
      .terminal__header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #334155;
        margin-bottom: 0.75rem;
      }
      .terminal__dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }
      .terminal__body {
        height: 150px;
        overflow-y: auto;
        color: #94a3b8;
      }
      .terminal__body p {
        margin: 0;
        padding: 0.2rem 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .log-prompt {
        color: var(--brand-green);
      }
      .log-computed {
        color: var(--brand-primary-light);
      }
      .log-effect {
        color: var(--brand-purple);
      }
      .log-info {
        color: #64748b;
      }

      /* --- Accordion --- */
      .accordion-item {
        border-bottom: 1px solid var(--border-color);
      }
      .accordion-item:last-child {
        border-bottom: none;
      }
      .accordion-header {
        cursor: pointer;
        padding: 1.25rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        color: var(--text-primary);
        transition: background-color 0.2s;
      }
      .accordion-header:hover {
        background-color: var(--bg-secondary);
      }
      .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .accordion-content div {
        padding: 0 1.25rem 1.25rem;
      }
      .accordion-icon {
        transition: transform 0.3s ease;
      }

      /* --- Input Fields --- */
      .form-input {
        width: 100%;
        padding: 0.6rem 0.85rem;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        background: var(--bg-primary);
        transition: all 0.2s ease;
        color: var(--text-primary);
      }
      .dark .form-input {
        border-color: #4b5563;
        background-color: #1f2937;
      }
      .form-input:focus {
        outline: none;
        border-color: var(--brand-primary);
        box-shadow: 0 0 0 3px var(--shadow-color);
      }
    </style>
  </head>
  <body class="bg-bg-secondary">
    <header
      class="md:hidden sticky top-0 z-20 flex items-center justify-between p-4 bg-bg-primary border-b border-border-color"
    >
      <h1 class="text-xl font-bold text-brand-red">
        Angular <span class="text-text-primary">Signals</span>
      </h1>
      <button id="sidebar-toggle" class="p-2 rounded-md">
        <i data-lucide="menu"></i>
      </button>
    </header>

    <div class="flex">
      <aside
        id="sidebar"
        class="w-72 fixed md:sticky top-0 h-screen p-4 z-30 md:transform-none overflow-y-auto"
      >
        <h1
          class="hidden md:block text-2xl font-bold text-gray-800 mb-6 border-b-2 pb-4 border-border-color"
        >
          <span class="text-brand-red">Angular</span> Signals
        </h1>
        <nav class="flex flex-col space-y-1">
          <a
            href="#intro"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="zap" class="w-5 h-5"></i>مقدمة: ما هي السيجنالز؟</a
          >

          <h3
            class="font-bold mt-6 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider"
          >
            الأساسيات
          </h3>
          <a
            href="#creating-signals"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="plus-circle" class="w-5 h-5"></i>إنشاء سيجنال</a
          >
          <a
            href="#reading-signals"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="eye" class="w-5 h-5"></i>قراءة السيجنال</a
          >
          <a
            href="#updating-signals"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="edit" class="w-5 h-5"></i>تحديث السيجنال</a
          >

          <h3
            class="font-bold mt-6 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider"
          >
            المفاهيم الأساسية
          </h3>
          <a
            href="#computed-signals"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="function-square" class="w-5 h-5"></i>الحالة المشتقة
            (`computed`)</a
          >
          <a
            href="#effects"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="cpu" class="w-5 h-5"></i>الآثار الجانبية
            (`effect`)</a
          >

          <h3
            class="font-bold mt-6 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider"
          >
            مفاهيم متقدمة
          </h3>
          <a
            href="#readonly"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="shield-check" class="w-5 h-5"></i>سيجنال للقراءة
            فقط</a
          >
          <a
            href="#encapsulation"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="lock" class="w-5 h-5"></i>نمط تغليف الحالة</a
          >
          <a
            href="#equal-function"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="scale" class="w-5 h-5"></i>التحكم في المقارنة
            (`equal`)</a
          >

          <h3
            class="font-bold mt-6 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider"
          >
            أنماط عملية
          </h3>
          <a
            href="#state-management"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="share-2" class="w-5 h-5"></i>إدارة الحالة العامة</a
          >
          <a
            href="#data-fetching"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="database" class="w-5 h-5"></i>جلب البيانات
            الديناميكي</a
          >

          <h3
            class="font-bold mt-6 mb-2 px-3 text-sm text-text-secondary uppercase tracking-wider"
          >
            أسئلة شائعة
          </h3>
          <a
            href="#faq"
            class="sidebar-link p-3 rounded-md flex items-center gap-3"
            ><i data-lucide="help-circle" class="w-5 h-5"></i>أسئلة وإجابات</a
          >
        </nav>
      </aside>

      <main class="w-full p-6 md:p-12 prose">
        <section id="intro">
          <h2>مقدمة: ما هي السيجنالز؟</h2>
          <p>
            قبل أن نتعمق في الكود، دعنا نبسط الفكرة الأساسية. تخيل أن كل قطعة
            بيانات متغيرة في تطبيقك هي "صندوق" ذكي. هذا الصندوق لا يحمل القيمة
            فقط، بل يمتلك أيضاً "جهاز إرسال" و"جهاز استقبال"، وهو التشبيه الرائع
            الذي تم استخدامه في الورشة.
          </p>
          <div class="grid md:grid-cols-2 gap-6 mt-8 not-prose">
            <div
              class="p-6 bg-bg-primary rounded-xl shadow-lg border border-border-color"
            >
              <div class="flex items-center gap-4">
                <div
                  class="p-3 bg-indigo-100 dark:bg-indigo-900/30 rounded-full"
                >
                  <i
                    data-lucide="arrow-up-right"
                    class="w-6 h-6 text-brand-primary"
                  ></i>
                </div>
                <h3 class="font-bold text-xl m-0">
                  جهاز الإرسال (Transmitter)
                </h3>
              </div>
              <p class="text-text-secondary mt-4">
                عندما تتغير القيمة داخل الصندوق، يقوم جهاز الإرسال بإعلام كل من
                يهتم بهذه القيمة بشكل فوري.
              </p>
            </div>
            <div
              class="p-6 bg-bg-primary rounded-xl shadow-lg border border-border-color"
            >
              <div class="flex items-center gap-4">
                <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-full">
                  <i
                    data-lucide="arrow-down-left"
                    class="w-6 h-6 text-brand-green"
                  ></i>
                </div>
                <h3 class="font-bold text-xl m-0">جهاز الاستقبال (Receiver)</h3>
              </div>
              <p class="text-text-secondary mt-4">
                في كل مكان يتم استخدام هذه القيمة، يوجد جهاز استقبال "يستمع" لأي
                تغييرات. فور وصول إشارة التغيير، يتم تحديث الواجهة أو تنفيذ منطق
                برمجي معين بشكل تلقائي.
              </p>
            </div>
          </div>
          <p class="mt-8">
            هذه هي قوة الـ <strong>"Reactivity"</strong> أو
            <strong>"التفاعلية"</strong> التي تقدمها السيجنالز: نظام فعال ودقيق
            لمعرفة <strong>ماذا تغير</strong> و
            <strong>أين يجب أن يتم التحديث</strong>، وذلك بأقل مجهود ممكن وبأداء
            عالٍ جداً.
          </p>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="creating-signals">
          <h2>1.1 إنشاء سيجنال (`signal`)</h2>
          <p>
            لإنشاء سيجنال، نستخدم دالة <code>signal()</code> التي يتم استيرادها
            من <code>@angular/core</code>. نمرر القيمة الأولية كوسيط لهذه
            الدالة.
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>import { Component, signal } from '@angular/core';

@Component({ /* ... */ })
export class AppComponent {
  // إنشاء سيجنال من نوع string
  pageTitle = signal&lt;string&gt;('مرحباً بالسيجنالز!');

  // إنشاء سيجنال من نوع number (سيتم استنتاج النوع)
  userCount = signal(50);

  // إنشاء سيجنال يحتوي على object
  user = signal({ name: 'علي', loggedIn: true });
}</code></pre>
          <div class="callout callout-info">
            <i
              data-lucide="lightbulb"
              class="w-5 h-5 text-brand-primary flex-shrink-0 mt-1"
            ></i>
            <div>
              <h4 class="font-bold text-lg m-0 mb-1 text-text-primary">
                ملاحظة
              </h4>
              <p>
                أنجلولار ذكي بما يكفي لاستنتاج النوع (Type Inference) في معظم
                الحالات، لكن من الممارسة الجيدة تحديد النوع بشكل صريح
                (<code>&lt;string&gt;</code>)، خاصة مع الكائنات المعقدة لضمان
                سلامة الأنواع (Type Safety).
              </p>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="reading-signals">
          <h2>1.2 قراءة السيجنال</h2>
          <p>
            لقراءة القيمة المخزنة داخل سيجنال، نتعامل مع السيجنال كأنها دالة
            ونستدعيها باستخدام الأقواس <code>()</code>. هذا ينطبق سواء في كود
            TypeScript أو في قوالب HTML.
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>// في الكلاس
logTitle() {
  // لقراءة القيمة، نستخدم pageTitle()
  console.log(this.pageTitle()); // "مرحباً بالسيجنالز!"
}

// في القالب (Template)
// يتم استدعاؤها أيضاً بالأقواس
&lt;h2&gt;المستخدم الحالي: {{ user().name }}&lt;/h2&gt;
</code></pre>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="updating-signals">
          <h2>1.3 تحديث السيجنال (`set` & `update`)</h2>
          <p>
            هناك طريقتان رئيسيتان لتحديث السيجنال، واختيار الطريقة المناسبة
            يعتمد على طبيعة التحديث الذي تريد القيام به.
          </p>
          <h3 class="mt-8">1. `set()`: الاستبدال الكامل</h3>
          <p>
            تستخدم <code>set()</code> لاستبدال القيمة القديمة بالكامل بقيمة
            جديدة. هي مناسبة للقيم الأولية (Primitives) أو عندما تريد تغيير
            الكائن بأكمله.
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>updateTitle() {
  this.pageTitle.set('عنوان جديد كلياً!');
}</code></pre>

          <h3 class="mt-8">
            2. `update()`: التحديث المعتمد على القيمة السابقة
          </h3>
          <p>
            تستخدم <code>update()</code> عندما تحتاج إلى تعديل القيمة بناءً على
            حالتها السابقة. تأخذ دالة كوسيط، وهذه الدالة تستقبل القيمة الحالية
            (<code>current</code>) وتعيد القيمة الجديدة. هذا ضروري بشكل خاص
            للكائنات والمصفوفات لتجنب فقدان البيانات.
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>incrementCount() {
  // نأخذ القيمة الحالية (current) ونضيف عليها 1
  this.userCount.update(current => current + 1);
}

// مثال مع كائن (object)
logoutUser() {
  this.user.update(currentUser => {
    // نستخدم spread operator (...) للحفاظ على باقي الخصائص
    return { ...currentUser, loggedIn: false };
  });
}</code></pre>

          <div class="interactive-card not-prose">
            <div class="interactive-card__header">
              <h4>تجربة حية: تحديث السيجنالز</h4>
            </div>
            <div class="interactive-card__body space-y-6">
              <div class="p-4 bg-bg-secondary dark:bg-slate-800 rounded-lg">
                <p>
                  <strong>العنوان (باستخدام `set`):</strong>
                  <span
                    id="demo-title"
                    class="font-bold text-brand-primary"
                  ></span>
                </p>
                <button id="btn-set-title" class="btn btn-primary mt-3">
                  غير العنوان
                </button>
              </div>
              <div class="p-4 bg-bg-secondary dark:bg-slate-800 rounded-lg">
                <p>
                  <strong>العداد (باستخدام `update`):</strong>
                  <span
                    id="demo-counter"
                    class="font-bold text-brand-green"
                  ></span>
                </p>
                <button id="btn-update-counter" class="btn btn-primary mt-3">
                  زيادة العداد
                </button>
              </div>
              <div class="p-4 bg-bg-secondary dark:bg-slate-800 rounded-lg">
                <p>
                  <strong>حالة المستخدم (باستخدام `update` لكائن):</strong>
                  <span
                    id="demo-user-status"
                    class="font-bold text-brand-red"
                  ></span>
                </p>
                <button id="btn-toggle-login" class="btn btn-primary mt-3">
                  تبديل حالة الدخول
                </button>
              </div>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="computed-signals">
          <h2>2. الحالة المشتقة (`computed`)</h2>
          <p>
            الـ <code>computed</code> سيجنال هي سيجنال
            <strong>للقراءة فقط</strong>، تُشتق قيمتها من سيجنال واحد أو أكثر.
            يتم إعادة حساب قيمتها تلقائياً فقط عند تغير أي من السيجنالز التي
            تعتمد عليها.
          </p>
          <div class="interactive-card not-prose">
            <div class="interactive-card__header">
              <h4>تجربة حية: `computed`</h4>
            </div>
            <div class="interactive-card__body interactive-card__body--grid">
              <div class="space-y-4">
                <div>
                  <label class="font-semibold">العداد الأصلي:</label>
                  <div class="flex items-center gap-3 mt-2">
                    <button
                      id="btn-computed-inc"
                      class="btn btn-primary w-12 text-xl"
                    >
                      +
                    </button>
                    <span
                      id="computed-original"
                      class="text-2xl font-bold w-12 text-center"
                    ></span>
                    <button
                      id="btn-computed-dec"
                      class="btn btn-danger w-12 text-xl"
                    >
                      -
                    </button>
                  </div>
                </div>
                <hr class="border-border-color" />
                <div>
                  <p class="font-semibold text-text-secondary">قيمة مشتقة 1:</p>
                  <p>
                    <strong>`double` = </strong
                    ><span
                      id="computed-double"
                      class="font-bold text-brand-primary text-xl"
                    ></span>
                  </p>
                </div>
                <div>
                  <p class="font-semibold text-text-secondary">قيمة مشتقة 2:</p>
                  <p>
                    <strong>`isEven` = </strong
                    ><span
                      id="computed-iseven"
                      class="font-bold text-brand-green text-xl"
                    ></span>
                  </p>
                </div>
              </div>
              <div class="terminal">
                <div class="terminal__header">
                  <div class="terminal__dot bg-red-500"></div>
                  <div class="terminal__dot bg-yellow-500"></div>
                  <div class="terminal__dot bg-green-500"></div>
                </div>
                <div class="terminal__body" id="computed-console"></div>
              </div>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="effects">
          <h2>3. الآثار الجانبية (`effect`)</h2>
          <p>
            الـ <code>effect</code> هي عملية يتم تنفيذها كلما تغيرت قيمة أي
            سيجنال مستخدم بداخلها. هي مخصصة للآثار الجانبية (Side Effects) التي
            لا علاقة لها مباشرةً برسم الواجهة.
          </p>
          <div class="callout callout-warning">
            <i
              data-lucide="alert-triangle"
              class="w-5 h-5 text-yellow-500 flex-shrink-0 mt-1"
            ></i>
            <div>
              <h4 class="font-bold text-lg m-0 mb-1 text-text-primary">
                تحذير
              </h4>
              <p>
                لا تقم بتعديل أي سيجنال داخل <code>effect</code> إلا بحذر شديد،
                فقد يؤدي ذلك إلى حلقة لا نهائية (infinite loop). الـ
                <code>effect</code> يجب أن يكون نقطة نهاية التفاعل، وليس بداية
                تفاعل جديد.
              </p>
            </div>
          </div>
          <div class="interactive-card not-prose">
            <div class="interactive-card__header">
              <h4>تجربة حية: `effect`</h4>
            </div>
            <div class="interactive-card__body interactive-card__body--grid">
              <div class="space-y-4">
                <div>
                  <p>
                    <strong>معرف المستخدم (متتبع):</strong>
                    <span id="effect-userid" class="font-bold"></span>
                  </p>
                  <button
                    id="btn-effect-changeuser"
                    class="btn btn-primary mt-2"
                  >
                    غير المستخدم
                  </button>
                </div>
                <div>
                  <p>
                    <strong>العداد (قد يكون غير متتبع):</strong>
                    <span id="effect-counter" class="font-bold"></span>
                  </p>
                  <button
                    id="btn-effect-inccounter"
                    class="btn btn-primary mt-2"
                  >
                    زيادة العداد
                  </button>
                </div>
                <div
                  class="mt-2 flex items-center p-3 bg-bg-secondary dark:bg-slate-800 rounded-lg"
                >
                  <input
                    type="checkbox"
                    id="untrack-checkbox"
                    class="ml-2 h-4 w-4 rounded cursor-pointer"
                  />
                  <label
                    for="untrack-checkbox"
                    class="text-text-secondary cursor-pointer"
                    >استخدم `untracked` على العداد</label
                  >
                </div>
              </div>
              <div class="terminal">
                <div class="terminal__header">
                  <div class="terminal__dot bg-red-500"></div>
                  <div class="terminal__dot bg-yellow-500"></div>
                  <div class="terminal__dot bg-green-500"></div>
                </div>
                <div class="terminal__body" id="effect-console"></div>
              </div>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="readonly">
          <h2>4.1 سيجنال للقراءة فقط (`asReadonly`)</h2>
          <p>
            في بعض الأحيان، تريد عرض حالة (State) للعالم الخارجي (مكونات أخرى)
            دون السماح لهم بتعديلها مباشرة. هنا يأتي دور
            <code>.asReadonly()</code> الذي يعطيك نسخة من السيجنال يمكن قراءتها
            فقط، بدون دوال <code>set</code> أو <code>update</code>.
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>// داخل سيرفس أو مكون أب
private _state = signal({ count: 0 });

// نعرض نسخة للقراءة فقط للعالم الخارجي
public readonly state = this._state.asReadonly();

// طرق التعديل تبقى خاصة داخل السيرفس
public increment() {
    this._state.update(s => ({ ...s, count: s.count + 1 }));
}
</code></pre>
          <div class="callout callout-warning">
            <i
              data-lucide="shield-alert"
              class="w-5 h-5 text-yellow-500 flex-shrink-0 mt-1"
            ></i>
            <div>
              <h4 class="font-bold text-lg m-0 mb-1 text-text-primary">
                ملاحظة هامة
              </h4>
              <p>
                كما ذكر في الورشة، <code>asReadonly()</code> يمنع استدعاء
                <code>.set()</code> و <code>.update()</code>, لكنه لا يمنع إعادة
                تعيين المتغير نفسه (<code>state = signal(...)</code>) إذا لم يكن
                <code>readonly</code> في TypeScript. لهذا السبب، النمط التالي
                (تغليف الحالة) يعتبر أكثر أماناً وقوة.
              </p>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="encapsulation">
          <h2>4.2 نمط تغليف الحالة (State Encapsulation)</h2>
          <p>
            هذا هو النمط المفضل والأكثر أماناً لمشاركة الحالة، خاصة عند بناء
            Services. الفكرة هي إخفاء السيجنال القابل للكتابة (writable signal)
            كخاصية خاصة (private)، وعرض قيمته فقط عبر
            <code>computed</code> signal أو دالة getter.
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>// في StateService.ts
import { signal, computed, Injectable } from '@angular/core';

@Injectable({ providedIn: 'root' })
export class StateService {

  // 1. السيجنال الأصلي خاص ولا يمكن الوصول إليه من الخارج
  private state = signal({ user: 'Guest', theme: 'light' });

  // 2. عرض أجزاء من الحالة كـ computed signals للقراءة فقط
  public currentUser = computed(() => this.state().user);
  public currentTheme = computed(() => this.state().theme);

  // 3. توفير دوال عامة (public) لتعديل الحالة بشكل آمن
  public login(userName: string) {
    this.state.update(s => ({ ...s, user: userName }));
  }

  public toggleTheme() {
    this.state.update(s => ({ ...s, theme: s.theme === 'light' ? 'dark' : 'light' }));
  }
}</code></pre>
          <p>
            بهذه الطريقة، المكونات الأخرى لا يمكنها تعديل الحالة إلا عبر الدوال
            المخصصة لذلك، مما يضمن أن التغييرات تحدث بطريقة متوقعة ومنظمة.
          </p>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="equal-function">
          <h2>4.3 التحكم في المقارنة (`equal`)</h2>
          <p>
            افتراضياً، تستخدم السيجنالز مقارنة صارمة (<code>===</code>) لمعرفة
            ما إذا كانت القيمة الجديدة مختلفة. لكن في بعض الحالات، قد تريد تعريف
            منطق مقارنة خاص بك. يمكنك فعل ذلك عبر خاصية <code>equal</code> عند
            إنشاء السيجنال.
          </p>
          <p>
            المثال الذي تم شرحه: منع التحديثات إذا كان التغيير فقط في حالة
            الأحرف (case).
          </p>
          <pre><button class="copy-btn"><i data-lucide="copy" class="w-4 h-4"></i></button><code>name = signal('Mostafa', {
  // دالة المقارنة تأخذ القيمة القديمة (a) والجديدة (b)
  equal: (a, b) => a.toLowerCase() === b.toLowerCase() 
});

// سيجنال مشتق سيتأثر فقط عند تغير الاسم فعلياً (وليس فقط حالة الأحرف)
welcomeMessage = computed(() => `Welcome, ${this.name()}!`);
</code></pre>
          <div class="interactive-card not-prose">
            <div class="interactive-card__header">
              <h4>تجربة حية: دالة `equal`</h4>
            </div>
            <div class="interactive-card__body interactive-card__body--grid">
              <div class="space-y-4">
                <div>
                  <label for="equal-input" class="font-semibold"
                    >أدخل اسماً:</label
                  >
                  <input type="text" id="equal-input" class="form-input mt-2" />
                </div>
                <hr class="border-border-color" />
                <div>
                  <p class="font-semibold text-text-secondary">
                    الرسالة الترحيبية (مشتقة):
                  </p>
                  <p
                    id="equal-output"
                    class="font-bold text-brand-primary text-xl"
                  ></p>
                </div>
              </div>
              <div class="terminal">
                <div class="terminal__header">
                  <div class="terminal__dot bg-red-500"></div>
                  <div class="terminal__dot bg-yellow-500"></div>
                  <div class="terminal__dot bg-green-500"></div>
                </div>
                <div class="terminal__body" id="equal-console"></div>
              </div>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="state-management">
          <h2>5.1 نمط عملي: إدارة الحالة العامة</h2>
          <p>
            يمكن للسيجنالز أن تكون بديلاً قوياً وبسيطاً لمكتبات إدارة الحالة
            المعقدة مثل NgRx في العديد من التطبيقات. الفكرة هي إنشاء Service
            مركزي يحمل الحالة كمجموعة من السيجنالز.
          </p>
          <p>
            في هذا المثال، لدينا "مكونان" على نفس الصفحة يقرآن ويعدلان نفس
            الحالة المشتركة من سيرفس وهمي. لاحظ كيف أن تغيير الحالة من أي مكون
            ينعكس فوراً على الآخر.
          </p>
          <div class="interactive-card not-prose">
            <div class="interactive-card__header">
              <h4>تجربة حية: حالة مشتركة بين المكونات</h4>
            </div>
            <div class="interactive-card__body interactive-card__body--grid">
              <div
                class="p-6 border border-border-color rounded-lg bg-bg-secondary dark:bg-slate-800"
              >
                <h5
                  class="font-bold text-lg text-text-primary flex items-center gap-2"
                >
                  <i
                    data-lucide="layout-dashboard"
                    class="text-brand-primary"
                  ></i
                  >المكون (أ): لوحة التحكم
                </h5>
                <p class="mt-4 text-text-secondary">
                  المستخدم الحالي:
                  <strong id="comp-a-user" class="text-brand-primary"></strong>
                </p>
                <p class="text-text-secondary">
                  المظهر الحالي:
                  <strong id="comp-a-theme" class="text-brand-purple"></strong>
                </p>
                <button id="btn-comp-a-login" class="btn btn-primary mt-4">
                  تسجيل دخول "أحمد"
                </button>
              </div>
              <div
                class="p-6 border border-border-color rounded-lg bg-bg-secondary dark:bg-slate-800"
              >
                <h5
                  class="font-bold text-lg text-text-primary flex items-center gap-2"
                >
                  <i data-lucide="chrome" class="text-brand-green"></i>المكون
                  (ب): الشريط العلوي
                </h5>
                <p class="mt-4 text-text-secondary">
                  مرحباً,
                  <strong id="comp-b-user" class="text-brand-primary"></strong>!
                </p>
                <p class="text-text-secondary">
                  المظهر:
                  <strong id="comp-b-theme" class="text-brand-purple"></strong>
                </p>
                <button id="btn-comp-b-theme" class="btn btn-primary mt-4">
                  تغيير المظهر
                </button>
              </div>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="data-fetching">
          <h2>5.2 نمط عملي: جلب البيانات الديناميكي</h2>
          <p>
            هذا واحد من أقوى أنماط الاستخدام. يمكننا وضع كل متغيرات جلب البيانات
            (مثل الصفحة الحالية، الفلاتر، مفتاح البحث) في سيجنال واحد. ثم نستخدم
            <code>effect</code> لمراقبة هذا السيجنال، وفي كل مرة يتغير أي جزء
            منه، يتم استدعاء API لجلب البيانات المحدثة تلقائياً.
          </p>
          <div class="interactive-card not-prose">
            <div class="interactive-card__header">
              <h4>تجربة حية: جلب بيانات الجدول</h4>
            </div>
            <div class="interactive-card__body">
              <div
                class="flex flex-col md:flex-row flex-wrap gap-6 items-center p-4 bg-bg-secondary dark:bg-slate-800 rounded-lg"
              >
                <div class="flex items-center gap-2">
                  <label class="font-semibold text-text-secondary"
                    >الصفحة:</label
                  >
                  <button id="btn-fetch-prev" class="btn btn-secondary w-10">
                    -
                  </button>
                  <span
                    id="fetch-page-display"
                    class="font-bold text-lg w-8 text-center"
                    >1</span
                  >
                  <button id="btn-fetch-next" class="btn btn-secondary w-10">
                    +
                  </button>
                </div>
                <div class="flex items-center gap-2">
                  <label
                    for="fetch-filter"
                    class="font-semibold text-text-secondary"
                    >فلتر:</label
                  >
                  <select id="fetch-filter" class="form-input w-40">
                    <option value="all">الكل</option>
                    <option value="active">النشطين</option>
                    <option value="inactive">غير النشطين</option>
                  </select>
                </div>
              </div>
              <div class="terminal mt-6">
                <div class="terminal__header">
                  <div class="terminal__dot bg-red-500"></div>
                  <div class="terminal__dot bg-yellow-500"></div>
                  <div class="terminal__dot bg-green-500"></div>
                </div>
                <div class="terminal__body" id="fetch-console"></div>
              </div>
              <div
                id="fetch-results"
                class="mt-6 p-4 border border-border-color rounded-lg bg-bg-secondary dark:bg-slate-800 min-h-[100px]"
              ></div>
            </div>
          </div>
        </section>

        <hr class="my-12 border-border-color" />

        <section id="faq">
          <h2>6. أسئلة شائعة (FAQ)</h2>
          <div
            class="accordion w-full bg-bg-primary rounded-lg shadow-md mt-6 not-prose"
          >
            <div class="accordion-item">
              <div class="accordion-header">
                <span>هل السيجنالز بديل لـ RxJS؟</span>
                <i
                  data-lucide="chevron-down"
                  class="accordion-icon w-5 h-5"
                ></i>
              </div>
              <div class="accordion-content">
                <div
                  class="prose max-w-none prose-p:text-text-secondary dark:prose-p:text-slate-400"
                >
                  <p><strong>الإجابة المختصرة: لا.</strong></p>
                  <p>هما يحلان مشاكل مختلفة ويكملان بعضهما البعض.</p>
                  <ul class="text-text-secondary dark:text-slate-400">
                    <li>
                      <strong>السيجنالز (`Signals`)</strong>: مصممة لإدارة
                      الحالة (State-based). هي ممتازة في تمثيل القيم التي تتغير
                      بمرور الوقت وكيف تتفاعل الواجهة مع هذه التغييرات. هي تعرف
                      دائماً "القيمة الحالية".
                    </li>
                    <li>
                      <strong>RxJS</strong>: مصممة للتعامل مع الأحداث
                      (Event-based). هي قوية جداً في التعامل مع تدفقات الأحداث
                      غير المتزامنة بمرور الوقت (مثل نقرات المستخدم، استجابات
                      WebSocket، الأحداث المعقدة). هي تتعامل مع "أحداث" تحدث،
                      وليس بالضرورة أن يكون لها "قيمة حالية".
                    </li>
                  </ul>
                  <p>
                    أفضل ممارسة هي استخدامهما معاً. يمكنك استخدام القوة الكاملة
                    لـ RxJS للتعامل مع الأحداث المعقدة، ثم تحويل النتيجة
                    النهائية إلى سيجنال (<code>toSignal</code>) لعرضها بسهولة في
                    الواجهة.
                  </p>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <div class="accordion-header">
                <span>متى يجب أن أستخدم NgRx إذن؟</span>
                <i
                  data-lucide="chevron-down"
                  class="accordion-icon w-5 h-5"
                ></i>
              </div>
              <div class="accordion-content">
                <div
                  class="prose max-w-none prose-p:text-text-secondary dark:prose-p:text-slate-400"
                >
                  <p>
                    مع وجود السيجنالز، أصبحت الحاجة لـ NgRx أقل بكثير في معظم
                    التطبيقات. ومع ذلك، لا يزال NgRx قوياً جداً في سيناريوهات
                    محددة ومعقدة جداً:
                  </p>
                  <ul class="text-text-secondary dark:text-slate-400">
                    <li>
                      <strong>التطبيقات الضخمة (Enterprise-level):</strong>
                      عندما يكون لديك حالة معقدة جداً ومنطق أعمال متداخل، يوفر
                      NgRx هيكلاً صارماً (Actions, Reducers, Effects) يفرض نمطاً
                      موحداً على الفريق بأكمله.
                    </li>
                    <li>
                      <strong>التدقيق المتقدم (Advanced Auditing):</strong>
                      أدوات مثل NgRx DevTools قوية جداً لتتبع كل تغيير في الحالة
                      حدث في التطبيق، مما يسهل تصحيح الأخطاء في الأنظمة المعقدة.
                    </li>
                    <li>
                      <strong>عند العمل على منصة (Platform):</strong> كما ذكر في
                      الورشة، إذا كنت تبني منصة تحتوي على عدة تطبيقات صغيرة
                      تتشارك في حالة مركزية، فإن NgRx يوفر حلاً قوياً لتوحيد هذه
                      الحالة.
                    </li>
                  </ul>
                  <p>
                    <strong>القاعدة العامة:</strong> ابدأ بالسيجنالز. إذا وجدت
                    أن إدارة الحالة أصبحت فوضوية ومعقدة جداً، وقتها فقط فكر في
                    الانتقال إلى NgRx.
                  </p>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <div class="accordion-header">
                <span
                  >ماذا عن النماذج (Forms)؟ هل يمكن استخدام السيجنالز
                  معها؟</span
                >
                <i
                  data-lucide="chevron-down"
                  class="accordion-icon w-5 h-5"
                ></i>
              </div>
              <div class="accordion-content">
                <div
                  class="prose max-w-none prose-p:text-text-secondary dark:prose-p:text-slate-400"
                >
                  <p>
                    نعم، والمستقبل يبدو مشرقاً جداً في هذه النقطة! حالياً، يمكنك
                    ربط النماذج الحالية (Reactive Forms) بالسيجنالز يدوياً، ولكن
                    هذا يتطلب بعض الكود الإضافي.
                  </p>
                  <p>
                    <strong>الخبر السار:</strong> فريق أنجلولار يعمل حالياً على
                    "Signal-based Forms". هذا يعني أنه في المستقبل القريب، سيكون
                    هناك API جديد للنماذج مبني بالكامل على السيجنالز، مما سيجعل
                    الكود أبسط وأكثر تفاعلية وأسهل في التعامل معه. ترقب
                    التحديثات القادمة من فريق أنجلولار!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div
      id="sidebar-overlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"
    ></div>

    <script>
      // --- NO CHANGES WERE MADE TO THIS SCRIPT BLOCK ---
      lucide.createIcons();

      // --- Sidebar Toggle ---
      const sidebar = document.getElementById("sidebar");
      const sidebarToggle = document.getElementById("sidebar-toggle");
      const sidebarOverlay = document.getElementById("sidebar-overlay");
      const toggleSidebar = () => {
        sidebar.classList.toggle("open");
        sidebarOverlay.classList.toggle("hidden");
      };
      sidebarToggle.addEventListener("click", toggleSidebar);
      sidebarOverlay.addEventListener("click", toggleSidebar);
      document.querySelectorAll(".sidebar-link").forEach((link) => {
        link.addEventListener("click", () => {
          if (window.innerWidth < 768) {
            toggleSidebar();
          }
        });
      });

      // --- Simplified Reactivity System for Demos ---
      let activeEffect = null;
      const signal = (initialValue, options) => {
        let value = initialValue;
        const subscribers = new Set();
        const equalFn = options?.equal || ((a, b) => Object.is(a, b));
        const s = () => {
          if (activeEffect) activeEffect.dependencies.add(s);
          return value;
        };
        s._isSignal = true;
        s.set = (newValue) => {
          if (!equalFn(value, newValue)) {
            value = newValue;
            new Set(subscribers).forEach((sub) => sub());
          }
        };
        s.update = (updateFn) => s.set(updateFn(value));
        s.subscribe = (cb) => {
          subscribers.add(cb);
          return () => subscribers.delete(cb);
        };
        return s;
      };
      const effect = (effectFn) => {
        const runner = () => {
          if (runner.cleanups) runner.cleanups.forEach((c) => c());
          activeEffect = runner;
          runner.dependencies.clear();
          runner.cleanups.clear();
          effectFn();
          runner.dependencies.forEach((dep) => {
            const unsub = dep.subscribe(runner);
            runner.cleanups.add(unsub);
          });
          activeEffect = null;
        };
        runner.dependencies = new Set();
        runner.cleanups = new Set();
        runner();
      };
      const computed = (computeFn) => {
        let value;
        const s = signal(undefined);
        effect(() => {
          value = computeFn();
          s.set(value);
        });
        const getter = () => {
          if (activeEffect) activeEffect.dependencies.add(getter);
          return value;
        };
        getter.subscribe = s.subscribe;
        return getter;
      };
      const logToTerminal = (terminalId, message, type = "info") => {
        const terminalBody = document.getElementById(terminalId);
        if (!terminalBody) return;
        const icon =
          type === "computed"
            ? "function-square"
            : type === "effect"
            ? "cpu"
            : "chevron-right";
        const colorClass = `log-${type}`;
        terminalBody.innerHTML += `<p><i data-lucide="${icon}" class="w-4 h-4 ${colorClass}"></i> ${message}</p>`;
        lucide.createIcons();
        terminalBody.scrollTop = terminalBody.scrollHeight;
      };

      // --- Demo Implementations ---

      // Demo 1: Updating Signals
      const demoTitle = signal("عنوان ابتدائي");
      const demoCounter = signal(0);
      const demoUser = signal({ name: "علي", loggedIn: true });
      effect(() => {
        document.getElementById("demo-title").textContent = demoTitle();
        document.getElementById("demo-counter").textContent = demoCounter();
        const user = demoUser();
        document.getElementById("demo-user-status").textContent = `${
          user.name
        } - ${user.loggedIn ? "مسجل دخوله" : "غير مسجل"}`;
      });
      document
        .getElementById("btn-set-title")
        .addEventListener("click", () =>
          demoTitle.set("عنوان تم تغييره بـ set()!")
        );
      document
        .getElementById("btn-update-counter")
        .addEventListener("click", () => demoCounter.update((c) => c + 1));
      document
        .getElementById("btn-toggle-login")
        .addEventListener("click", () =>
          demoUser.update((u) => ({ ...u, loggedIn: !u.loggedIn }))
        );

      // Demo 2: Computed
      const computedCount = signal(1);
      const computedDouble = computed(() => {
        logToTerminal(
          "computed-console",
          `[Computed] تم حساب double()`,
          "computed"
        );
        return computedCount() * 2;
      });
      const computedIsEven = computed(() => computedCount() % 2 === 0);
      effect(() => {
        document.getElementById("computed-original").textContent =
          computedCount();
        document.getElementById("computed-double").textContent =
          computedDouble();
        document.getElementById("computed-iseven").textContent =
          computedIsEven() ? "زوجي" : "فردي";
      });
      logToTerminal("computed-console", `جرب تغيير العداد`, "info");
      document
        .getElementById("btn-computed-inc")
        .addEventListener("click", () => computedCount.update((c) => c + 1));
      document
        .getElementById("btn-computed-dec")
        .addEventListener("click", () => computedCount.update((c) => c - 1));

      // Demo 3: Effect
      const effectUserId = signal(1);
      const effectCounterVal = signal(0);
      const untrackCheckbox = document.getElementById("untrack-checkbox");
      effect(() => {
        const useUntracked = untrackCheckbox.checked;
        const userId = effectUserId(); // Always track user ID
        let counterVal;
        // Simplified untrack: only depend on effectCounterVal if checkbox is unchecked
        if (!useUntracked) {
          counterVal = effectCounterVal();
        } else {
          // get value without creating dependency
          const tempEffect = activeEffect;
          activeEffect = null;
          counterVal = effectCounterVal();
          activeEffect = tempEffect;
        }
        logToTerminal(
          "effect-console",
          `تم التنفيذ. ID المستخدم: ${userId}, العداد: ${counterVal}`,
          "effect"
        );
      });
      effect(() => {
        document.getElementById("effect-userid").textContent = effectUserId();
        document.getElementById("effect-counter").textContent =
          effectCounterVal();
      });
      logToTerminal(
        "effect-console",
        `الـ Effect سيراقب "معرف المستخدم" دائماً.`,
        "info"
      );
      document
        .getElementById("btn-effect-changeuser")
        .addEventListener("click", () => effectUserId.update((id) => id + 1));
      document
        .getElementById("btn-effect-inccounter")
        .addEventListener("click", () => effectCounterVal.update((c) => c + 1));

      // Demo 4: Equal Function
      const equalName = signal("Mostafa", {
        equal: (a, b) => a.trim().toLowerCase() === b.trim().toLowerCase(),
      });
      const equalWelcomeMsg = computed(() => {
        logToTerminal(
          "equal-console",
          `[Computed] تم إعادة حساب الرسالة الترحيبية.`,
          "computed"
        );
        return `مرحباً بك يا, ${equalName()}!`;
      });
      const equalInput = document.getElementById("equal-input");
      equalInput.value = equalName();
      effect(() => {
        document.getElementById("equal-output").textContent = equalWelcomeMsg();
      });
      equalInput.addEventListener("input", (e) =>
        equalName.set(e.target.value)
      );
      logToTerminal("equal-console", `جرب كتابة Mostafa ثم mostafa`, "info");

      // Demo 5: State Management
      const stateService = (() => {
        const _state = signal({ user: "زائر", theme: "فاتح" });
        return {
          user: computed(() => _state().user),
          theme: computed(() => _state().theme),
          login: (name) => _state.update((s) => ({ ...s, user: name })),
          toggleTheme: () =>
            _state.update((s) => ({
              ...s,
              theme: s.theme === "فاتح" ? "داكن" : "فاتح",
            })),
        };
      })();
      effect(() => {
        const user = stateService.user();
        const theme = stateService.theme();
        document.getElementById("comp-a-user").textContent = user;
        document.getElementById("comp-b-user").textContent = user;
        document.getElementById("comp-a-theme").textContent = theme;
        document.getElementById("comp-b-theme").textContent = theme;
      });
      document
        .getElementById("btn-comp-a-login")
        .addEventListener("click", () => stateService.login("أحمد"));
      document
        .getElementById("btn-comp-b-theme")
        .addEventListener("click", () => stateService.toggleTheme());

      // Demo 6: Data Fetching
      const paginationSignal = signal({ page: 1, filter: "all" });
      effect(() => {
        const { page, filter } = paginationSignal();
        logToTerminal(
          "fetch-console",
          `[Effect] استدعاء API بالمعلومات: { page: ${page}, filter: '${filter}' }`,
          "effect"
        );
        const fetchResults = document.getElementById("fetch-results");
        fetchResults.innerHTML = `<p class="flex items-center gap-2 text-text-secondary"><i data-lucide="loader" class="w-4 h-4 animate-spin"></i>جاري التحميل...</p>`;
        lucide.createIcons();
        setTimeout(() => {
          fetchResults.innerHTML = `
                    <h5 class="font-bold text-text-primary">نتائج وهمية</h5>
                    <ul class="list-disc pr-6 text-text-secondary">
                        <li>- مستخدم ${page * 3 - 2} (فلتر: ${filter})</li>
                        <li>- مستخدم ${page * 3 - 1} (فلتر: ${filter})</li>
                        <li>- مستخدم ${page * 3} (فلتر: ${filter})</li>
                    </ul>`;
        }, 500);
      });
      effect(() => {
        document.getElementById("fetch-page-display").textContent =
          paginationSignal().page;
      });
      document
        .getElementById("btn-fetch-next")
        .addEventListener("click", () =>
          paginationSignal.update((p) => ({ ...p, page: p.page + 1 }))
        );
      document
        .getElementById("btn-fetch-prev")
        .addEventListener("click", () =>
          paginationSignal.update((p) => ({
            ...p,
            page: Math.max(1, p.page - 1),
          }))
        );
      document
        .getElementById("fetch-filter")
        .addEventListener("change", (e) =>
          paginationSignal.update((p) => ({ ...p, filter: e.target.value }))
        );

      // --- General Utilities: Copy Button & Accordion ---
      document.querySelectorAll(".copy-btn").forEach((button) => {
        button.addEventListener("click", (e) => {
          const pre = e.currentTarget.parentElement;
          const code = pre.querySelector("code").innerText;
          navigator.clipboard.writeText(code).then(() => {
            e.currentTarget.innerHTML =
              '<i data-lucide="check" class="w-4 h-4 text-green-400"></i>';
            lucide.createIcons();
            setTimeout(() => {
              e.currentTarget.innerHTML =
                '<i data-lucide="copy" class="w-4 h-4"></i>';
              lucide.createIcons();
            }, 2000);
          });
        });
      });

      document.querySelectorAll(".accordion-header").forEach((header) => {
        header.addEventListener("click", () => {
          const content = header.nextElementSibling;
          const icon = header.querySelector(".accordion-icon");
          if (content.style.maxHeight) {
            content.style.maxHeight = null;
            icon.style.transform = "rotate(0deg)";
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
            icon.style.transform = "rotate(180deg)";
          }
        });
      });

      // --- Sidebar Active Link ---
      const sections = document.querySelectorAll("main section");
      const navLinks = document.querySelectorAll(".sidebar-link");
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const id = entry.target.getAttribute("id");
              navLinks.forEach((link) => {
                link.classList.toggle(
                  "active",
                  link.getAttribute("href") === `#${id}`
                );
              });
            }
          });
        },
        { rootMargin: "-30% 0px -70% 0px" }
      );
      sections.forEach((section) => observer.observe(section));
    </script>
  </body>
</html>
